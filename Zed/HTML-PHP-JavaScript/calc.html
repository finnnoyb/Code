<!doctype html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Taschenrechner</title>
        <script
            crossorigin
            src="https://unpkg.com/react@18/umd/react.production.min.js"
        ></script>
        <script
            crossorigin
            src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
        ></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap"
            rel="stylesheet"
        />
        <style>
            @keyframes float {
                0%,
                100% {
                    transform: translateY(0px) rotate(0deg);
                }
                50% {
                    transform: translateY(-20px) rotate(2deg);
                }
            }
            @keyframes glow {
                0%,
                100% {
                    box-shadow:
                        0 0 20px rgba(168, 85, 247, 0.4),
                        0 0 40px rgba(168, 85, 247, 0.2);
                }
                50% {
                    box-shadow:
                        0 0 30px rgba(168, 85, 247, 0.6),
                        0 0 60px rgba(168, 85, 247, 0.3);
                }
            }
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .calculator-container {
                animation:
                    float 6s ease-in-out infinite,
                    slideIn 0.8s ease-out;
            }
            .display-glow {
                animation: glow 2s ease-in-out infinite;
            }
            .calc-button {
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
            }
            .calc-button::before {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.3);
                transform: translate(-50%, -50%);
                transition:
                    width 0.6s,
                    height 0.6s;
            }
            .calc-button:active::before {
                width: 300px;
                height: 300px;
            }
            .calc-button:hover {
                transform: translateY(-2px);
                filter: brightness(1.2);
            }
            .calc-button:active {
                transform: translateY(0);
            }
            .number-btn {
                background: linear-gradient(145deg, #2d3748, #1a202c);
                border: 1px solid rgba(168, 85, 247, 0.3);
            }
            .operator-btn {
                background: linear-gradient(145deg, #7c3aed, #5b21b6);
                border: 1px solid rgba(168, 85, 247, 0.5);
            }
            .function-btn {
                background: linear-gradient(145deg, #dc2626, #991b1b);
                border: 1px solid rgba(239, 68, 68, 0.5);
            }
            .equals-btn {
                background: linear-gradient(145deg, #059669, #047857);
                border: 1px solid rgba(16, 185, 129, 0.5);
            }
            .digital-text {
                font-family: "Orbitron", monospace;
                text-shadow:
                    0 0 10px rgba(168, 85, 247, 0.8),
                    0 0 20px rgba(168, 85, 247, 0.4);
            }
        </style>
    </head>
    <body>
        <div id="root"></div>
        <script type="text/babel">
            const { useState } = React;

            function Calculator() {
                const [display, setDisplay] = useState("0");
                const [previousValue, setPreviousValue] = useState(null);
                const [operation, setOperation] = useState(null);
                const [waitingForOperand, setWaitingForOperand] =
                    useState(false);

                const inputDigit = (digit) => {
                    if (waitingForOperand) {
                        setDisplay(String(digit));
                        setWaitingForOperand(false);
                    } else {
                        setDisplay(
                            display === "0" ? String(digit) : display + digit,
                        );
                    }
                };

                const inputDecimal = () => {
                    if (waitingForOperand) {
                        setDisplay("0,");
                        setWaitingForOperand(false);
                    } else if (!display.includes(",")) {
                        setDisplay(display + ",");
                    }
                };

                const clear = () => {
                    setDisplay("0");
                    setPreviousValue(null);
                    setOperation(null);
                    setWaitingForOperand(false);
                };

                const parseDisplay = (val) => parseFloat(val.replace(",", "."));

                const performOperation = (nextOperation) => {
                    const inputValue = parseDisplay(display);
                    if (previousValue === null) {
                        setPreviousValue(inputValue);
                    } else if (operation) {
                        const newValue = calculate(
                            previousValue,
                            inputValue,
                            operation,
                        );
                        setDisplay(String(newValue).replace(".", ","));
                        setPreviousValue(newValue);
                    }
                    setWaitingForOperand(true);
                    setOperation(nextOperation);
                };

                const calculate = (a, b, op) => {
                    switch (op) {
                        case "+":
                            return a + b;
                        case "-":
                            return a - b;
                        case "*":
                            return a * b;
                        case "/":
                            return a / b;
                        default:
                            return b;
                    }
                };

                const handleEquals = () => {
                    const inputValue = parseDisplay(display);
                    if (previousValue !== null && operation) {
                        const newValue = calculate(
                            previousValue,
                            inputValue,
                            operation,
                        );
                        setDisplay(String(newValue).replace(".", ","));
                        setPreviousValue(null);
                        setOperation(null);
                        setWaitingForOperand(true);
                    }
                };

                // Layout:
                // Row 1: 7  8  9  /
                // Row 2: 4  5  6  *
                // Row 3: 1  2  3  -
                // Row 4: 0(wide)  ,  +
                // Row 5: =(wide)     C
                const buttons = [
                    { label: "7", action: () => inputDigit(7), type: "number" },
                    { label: "8", action: () => inputDigit(8), type: "number" },
                    { label: "9", action: () => inputDigit(9), type: "number" },
                    {
                        label: "/",
                        action: () => performOperation("/"),
                        type: "operator",
                    },

                    { label: "4", action: () => inputDigit(4), type: "number" },
                    { label: "5", action: () => inputDigit(5), type: "number" },
                    { label: "6", action: () => inputDigit(6), type: "number" },
                    {
                        label: "*",
                        action: () => performOperation("*"),
                        type: "operator",
                    },

                    { label: "1", action: () => inputDigit(1), type: "number" },
                    { label: "2", action: () => inputDigit(2), type: "number" },
                    { label: "3", action: () => inputDigit(3), type: "number" },
                    {
                        label: "-",
                        action: () => performOperation("-"),
                        type: "operator",
                    },

                    {
                        label: "0",
                        action: () => inputDigit(0),
                        type: "number",
                        span: 2,
                    },
                    { label: ",", action: inputDecimal, type: "number" },
                    {
                        label: "+",
                        action: () => performOperation("+"),
                        type: "operator",
                    },

                    {
                        label: "=",
                        action: handleEquals,
                        type: "equals",
                        span: 3,
                    },
                    { label: "C", action: clear, type: "function" },
                ];

                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4">
                        <div
                            className="calculator-container bg-gray-900 p-8 rounded-3xl shadow-2xl border-2 border-purple-500/30"
                            style={{ maxWidth: "400px", width: "100%" }}
                        >
                            <div className="text-center mb-6">
                                <h1 className="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 digital-text">
                                    :happi:
                                </h1>
                                <div className="h-1 w-20 mx-auto mt-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full"></div>
                            </div>

                            <div className="display-glow bg-black rounded-2xl p-6 mb-6 border-2 border-purple-500/50">
                                <div className="text-right">
                                    <div className="digital-text text-5xl font-bold text-purple-300 break-all">
                                        {display}
                                    </div>
                                    {operation && (
                                        <div className="text-sm text-purple-400/60 mt-2 digital-text">
                                            {previousValue} {operation}
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="grid grid-cols-4 gap-3">
                                {buttons.map((btn, index) => {
                                    let btnClass =
                                        "calc-button text-white font-bold rounded-xl shadow-lg text-xl py-4 ";
                                    if (btn.type === "number")
                                        btnClass += "number-btn";
                                    else if (btn.type === "operator")
                                        btnClass += "operator-btn";
                                    else if (btn.type === "function")
                                        btnClass += "function-btn";
                                    else if (btn.type === "equals")
                                        btnClass += "equals-btn";
                                    if (btn.span)
                                        btnClass += ` col-span-${btn.span}`;

                                    return (
                                        <button
                                            key={index}
                                            onClick={btn.action}
                                            className={btnClass}
                                            style={{
                                                fontFamily:
                                                    "'Space Mono', monospace",
                                            }}
                                        >
                                            {btn.label}
                                        </button>
                                    );
                                })}
                            </div>

                            <div className="mt-6 text-center">
                                <p className="text-purple-400/40 text-xs digital-text">
                                    ermge
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            const root = ReactDOM.createRoot(document.getElementById("root"));
            root.render(<Calculator />);
        </script>
    </body>
</html>